var _ScrollContentTop=0;$(document).ready(function(){if(window.Settings.Booking||window.Settings.Events||window.Settings.BookingActivity){window.InputCalendar=new InputCalendar("InputCalendar")}window.CurrentPage=new SearchPage();if($("#ScrollContent").length>0){_ScrollContentTop=$("#ScrollContent").offset().top}$(".Filters").show();$(window).bind("scroll",Window_Scroll);$(window).bind("unload",function(){window.CurrentPage.Dispose()});window.FormManager.Manage("df",window.CurrentPage.Search);window.FormManager.Manage("dt",window.CurrentPage.Search);window.FormManager.Manage("txtDateFrom",window.CurrentPage.Search);window.FormManager.Manage("txtQuery",window.CurrentPage.Search);$(".PliBody").live("click",function(){window.location=$(this).find(".PliText > a").eq(0).attr("href")})});function SearchPage(){var K=1,o=2;var r=30;var a=this;var H=new SearchEngine("RecordsContainer","/Ajax/BaseTool/Product.ashx",null,r,10,"rating",[],window.Translate.ErrorGlobalSearch);var q=[];var e=K;var j=(!window.Settings.Events)?new M2B.Maps.GMapBase():null;var i=null;var D=0;var C=0;var d={};var B=[];var h=(window.Settings.Booking)?new RoomConfig("RoomConfig"):null;var w=1;var g=0;var x=0;var l=true;var t=document.getElementById("RecordsContainer");var z={Collection:[{Name:"DateFrom",Element:document.getElementById("txtDateFrom")},{Name:"DateTo",Element:document.getElementById("txtDateTo")},{Name:"Query",Element:document.getElementById("txtQuery")},{Name:"Tdb",Element:document.getElementById("cbTdb")},{Name:"Interval",Element:document.getElementById("slctInterval")},{Name:"Bookable",Element:document.getElementById("cbBooking")},{Name:"Period",Element:document.getElementById("slctPeriod")}],Get:function(L){for(var M=0;M<this.Collection.length;M++){if(this.Collection[M].Name==L){return this.Collection[M]}}return null}};$(H).bind("OnSearchEnd",E);$(H).bind("OnRenderEnd",G);if(j!==null){$(j).bind("Marker_Click",v)}if(AjaxMgr.GetBaseToolParams()==null){$(AjaxMgr).bind("OnBaseToolParamsLoaded",y)}else{y()}function y(){var M=AjaxMgr.GetBaseToolParams();H.SetTemplate(((!window.Settings.Events)?"/Ajax/Templates/BaseToolSearch.aspx":"/Ajax/Templates/BaseToolSearchEvents.aspx")+"?l="+window.Settings.Lang+"&t="+window.Settings.Theme+"&channel="+window.AjaxMgr.GetBaseToolChannel()+"&p="+window.Settings.ProductPageUrl);if(j!==null){j.Init(window.Settings.GMapKey,{Region:window.Settings.Lang,FlagOffset:{x:12,y:-44},ClusterOptions:{maxZoom:15,styles:[{url:"/images/map/v3/icons/cluster2.png",width:26,height:46},{url:"/images/map/v3/icons/cluster5.png",width:26,height:46},{url:"/images/map/v3/icons/cluster10.png",width:26,height:46},{url:"/images/map/v3/icons/cluster25.png",width:26,height:46},{url:"/images/map/v3/icons/cluster50.png",width:26,height:46}],calculator:function(O){var N=1;if(O.length>49){N=5}else{if(O.length>24){N=4}else{if(O.length>9){N=3}else{if(O.length>4){N=2}}}}return{text:"",index:N}}},Icon:function(N){if(e==K){return"/images/map/v3/icons/static.png"}else{return"/images/map/v3/icons/cat"+N.data.Category+".png"}},IconHover:function(N){if(e==K){return"/images/map/v3/icons/static_hover.png"}else{return"/images/map/v3/icons/cat"+N.data.Category+"_hover.png"}},MapSettings:{mapTypeControl:false}},"RecordsMap",62.396396,17.525586,4,null,function(){i=j.AddButton([window.Translate.SearchMapMax,window.Translate.SearchMapMin],google.maps.ControlPosition.TOP_RIGHT,0,{x:0,y:5},function(){a.SwitchListMode()})})}M.Actn="search";M.l=window.Settings.Lang;if(window.Settings.Events){M.event="1";var L=z.Get("Interval").Element;d.df=z.Get("DateFrom").Element.value;d.iv=L.options[L.options.selectedIndex].value}if(window.Settings.BookingActivity){M.ba=1}M.pt=window.Settings.ProductType;H.SetGlobalSearchParams(M);H.SetOrder(window.Settings.DefaultOrder);$(z.Get("Query").Element).autocomplete("/Ajax/BaseTool/Area.ashx?channel="+window.AjaxMgr.GetBaseToolChannel(),{dataType:"json",parse:f,autoFill:false,cacheLength:30,max:8,delay:500,minChars:2,matchContains:true,mustMatch:false,matchSubset:true,selectFirst:false,width:124,formatItem:b,formatResult:b});$(z.Get("Query").Element).result(u);if(window.Settings.Filter){B=$.extend(B,window.Settings.Filter)}m();if(h!==null){h.Render()}$(t).loaderShow();a.Search()}this.Dispose=function(){p();if(j!==null){j.Dispose()}H.Dispose();H=null;j=null;a=null};this.Sort=function(L){H.SetOrder(L);this.Search()};this.SwitchEventView=function(L){if(!$("#"+L).hasClass("Selected")){w=(w==1)?2:1;H.SetTemplate((w==1?"/Ajax/Templates/BaseToolSearchEvents.aspx":"/Ajax/Templates/BaseToolSearchEventsDbD.aspx")+"?l="+window.Settings.Lang+"&t="+window.Settings.Theme+"&channel="+window.AjaxMgr.GetBaseToolChannel()+"&p="+window.Settings.ProductPageUrl);H.SetPageSize(w==1?10:30);H.SetPage(0);$("li",".ProductTabs").toggleClass("Selected");this.Search()}};this.FormatDate=function(M,L){var N=new Date(M).getDate()+" "+window.Translate.Months[new Date(M).getMonth()].substr(0,3);N+=" - "+new Date(L).getDate()+" "+window.Translate.Months[new Date(L).getMonth()].substr(0,3);return N};this.Search=function(L){d={};if(g>0){H.SetPage(0)}if(h!==null){d.df=z.Get("DateFrom").Element.value;d.dt=z.Get("DateTo").Element.value;d.rc=h.ToString()}if(window.Settings.Events){var M=z.Get("Interval").Element;d.df=z.Get("DateFrom").Element.value;d.iv=M.options[M.options.selectedIndex].value}if(window.Settings.BookingActivity){var P=z.Get("Period").Element;d.df=z.Get("DateFrom").Element.value;d.period=P.options[P.options.selectedIndex].value}d.q=z.Get("Query").Element.value;if(z.Get("Tdb").Element){d.HasTdb=z.Get("Tdb").Element.checked?1:0}if(z.Get("Bookable").Element){d.b=z.Get("Bookable").Element.checked?1:0}d.em=w;if(L!=null){if(B.FindAll("Property",L.Property).FindObj("Value",L.Value)==-1){B.push(L)}}for(var N=0;N<B.length;N++){var O=B[N];if(O.Multi){d[O.Property]=(d[O.Property]||"")+O.Value+","}else{d[O.Property]=O.Value}}n();$(t).loaderShow();g++;H.Search(d);if(e==K){if(L&&L.Property=="Areas"){I(L.Value)}else{I(d.q)}}p()};this.ViewPage=function(M,L){H.ViewPage(M);if(L){var N=document.getElementById("ctl00_divContentContainer");N.scrollIntoView?N.scrollIntoView(true):window.location.hash="#Content"}};this.SetRooms=function(L){h.SetRooms(L)};this.AddFavourite=function(L,N,M){window.Favourites.Add(N,M,window.Settings.Events?2:1);$(L).text(window.Translate.FavouriteSaved)};this.SwitchListMode=function(){if(e==K){$("#ctl00_cphMain_divCol2").hide();$("#ctl00_cphMain_divCol3").removeClass("QuarterCol").addClass("ThreeQuarterCol");$("#RecordsMap").css("height","500px");$(".TriggerBox").hide();j.Markers.Clear(true);j.SetClustered(true);j.Set({ShowFlag:true});H.SetCacheSize(0);H.SetPageSize(500);H.SetSuppressRender(true);t=document.getElementById("RecordsMap")}else{$("#ctl00_cphMain_divCol3").removeClass("ThreeQuarterCol").addClass("QuarterCol");$("#ctl00_cphMain_divCol2").show();$("#RecordsMap").css("height","300px");j.Markers.Clear(true);j.SetClustered(false);j.Set({ShowFlag:false});H.SetCacheSize(r);H.SetPageSize(10);H.SetSuppressRender(false);t=document.getElementById("RecordsContainer")}e=(e==K)?o:K;j.Refresh();this.Search()};this.PrintEvents=function(){var Q=AjaxMgr.GetBaseToolParams();var R=B.FindObj("Property","Areas");var P=R>-1?B[R].Value:Q.Areas;var M=B.FindObj("Property","Categories");var N=M>-1?B[M].Value:Q.Categories;var O=H.GetPage();var L="/Pages/EventsPrint.aspx?id="+window.Settings.PageId+"&l="+window.Settings.Lang+"&df="+d.df+"&iv="+d.iv+"&aid="+P+"&cid="+N+"&q="+(d.q||"")+"&p="+O;OpenWindow(L,"winPrint",800,600,true,true)};function n(){$("#SelectedFilters").empty();for(var L=0;L<B.length;L++){$("#SelectedFilters").createAppend("a",{href:"javascript://Remove;",title:window.Translate.Remove},B[L].Name).bind("click",{Filter:B[L]},c)}}function J(L){var N=/\(\d+\)/gi;if(L.FilterCategories!==null&&(B.FindObj("Property","Categories")==-1||g==1)){$("#"+window.Settings.FilterUls[0]+" a.FilterLink").each(function(){var P=$(this).text();$(this).text(P.replace(N,"(0)")).closest("li").removeClass("enabled").hide()});for(var M=0;M<L.FilterCategories.length;M++){$(".Categories_"+L.FilterCategories[M].Id).each(function(){var P=$(this).text();$(this).text(P.replace(N,"("+L.FilterCategories[M].Count+")")).closest("li").addClass("enabled").show()})}}if(L.FilterAreas!==null&&(B.FindObj("Property","Areas")==-1||g==1)){$("#"+window.Settings.FilterUls[1]+" a.FilterLink").each(function(){var P=$(this).text();$(this).text(P.replace(N,"(0)")).closest("li").removeClass("enabled").hide()});for(M=0;M<L.FilterAreas.length;M++){$(".Areas_"+L.FilterAreas[M].Id).each(function(){txt=$(this).text();$(this).text(txt.replace(N,"("+L.FilterAreas[M].Count+")")).closest("li").addClass("enabled").show()})}}if(g==1){$(".FilterSwitch > a").show();for(var M=0;M<window.Settings.FilterUls.length;M++){var O="#"+window.Settings.FilterUls[M];$(O).find("ul").prev("li").removeClass("SubItem");$(O).find("ul:not(:has(li.enabled))").prev("li").addClass("SubItem").find(".FilterSwitch > a").hide()}}}function p(){var N=["HasTdb","Order","b","df","dt","q","rc","sid","iv","period"];var L={PageId:window.Settings.PageId,Lang:window.Settings.Lang,Page:H.GetPage(),Search:{}};L.Filter=B||{};for(var O in d){if(N.Find(O)>-1&&typeof(d[O])!="undefined"&&d[O]!=null&&d[O]!="null"){L.Search[O]=d[O]}}var M=JSON.stringify(L);$.cookie("Search",M,{expires:new Date().add("h",1),path:"/",domain:window.Settings.Domain})}function m(){var L=$.cookie("ClearSearch");if(L!=null&&parseInt(L)==window.Settings.PageId){$.cookie("ClearSearch",null,{path:"/",domain:window.Settings.Domain});$.cookie("Search",null,{path:"/",domain:window.Settings.Domain});return}if($.cookie("Search")!=null){var M=JSON.parse($.cookie("Search"));if(M.PageId==window.Settings.PageId&&M.Lang==window.Settings.Lang){d=$.extend(d,M.Search);B=$.extend(B,M.Filter);H.SetPage(M.Page);if(M.Search.Order){H.SetOrder(M.Search.Order)}}}var P=GetQueryString("q");var R=GetQueryString("df");var O=GetQueryString("dt");var N=GetQueryString("rad");var Q=GetQueryString("per");if(P!==null){d.q=P}if(R!==null){d.df=R}if(O!==null){d.dt=O}if(N!==null){h.SetAdults(0,N);d.rc=h.ToString()}if(Q!==null){d.period=Q}if(d.rc){h=new RoomConfig("RoomConfig",d.rc)}if(d.q){$(z.Get("Query").Element).val(d.q)}if(d.df){$(z.Get("DateFrom").Element).val(d.df)}if(d.dt){$(z.Get("DateTo").Element).val(d.dt)}if(d.HasTdb&&d.HasTdb.toString()=="1"&&z.Get("Tdb").Element){z.Get("Tdb").Element.checked=true}if(d.b&&d.b.toString()=="1"){z.Get("Bookable").Element.checked=true}if(d.iv){$(z.Get("Interval").Element).val(d.iv)}if(d.period){$(z.Get("Period").Element).val(d.period)}}function E(L){if(typeof(L.Json.Error)!="undefined"){$("#JsError").html(window.Translate.ErrorDate+new Date().toFormat()).show();setTimeout(function(){$("#JsError").hide()},10000)}$(t).loaderHide();D=L.Json.Paging.TotalHits;H.SetParam("sid",L.Json.SearchId);if(L.Json.SearchId>0){window.Tracker.Event("Booking","SearchList","Hits",D)}if(L.Json.Seed!=null&&L.Json.Seed!=""){H.SetGlobalParam("seed",L.Json.Seed)}else{H.RemoveGlobalParam("seed")}J(L.Json)}function G(L){q=L.Items;if(j!==null){if(e==K){$("#RecordsContainer").find(".ProductListItem").each(function(M){$(this).bind("mouseover",{Index:M,Element:this},F);$(this).bind("mouseout",{Index:M,Element:this},F)})}A()}if(w){$(".PliCalendar").each(function(M){var N=new Date();N.parseFormat(d.df);var O=new EventCalendar($(this).attr("id"),q[M].Dates,N)})}if(!z.Get("DateTo").Element||z.Get("DateTo").Element==null||!z.Get("DateTo").Element.value){$("#PriceFilter").hide()}}function F(L){j.MarkerHover(q[L.data.Index].Id)}function c(N){var L=-1;for(var M=0;M<B.length;M++){if(B[M].Property==N.data.Filter.Property&&B[M].Value==N.data.Filter.Value){L=M;break}}_RemovedFilter=true;B.Remove(L);a.Search();if(N.data.Filter.Property=="Areas"){I(false)}}function I(){if(typeof(arguments[0])=="boolean"&&!arguments[0]){$("#ctl00_cphMain_BoxTrigger").hide()}else{var N=window.AjaxMgr.GetBaseToolParams();var L=typeof(arguments[0])=="string"?0:arguments[0];var M=L==0?arguments[0]:"";window.AjaxMgr.ReqJSON("/ajax/Page.ashx",{actn:"trig",sa:N.Areas,a:L,q:M,l:window.Settings.Lang},false,k,null)}}function k(L){if($("#Trigger").length>0&&L.Heading&&(L.Heading!=""||L.Body!="")){$("#Trigger").empty().createAppend("a",{href:L.Url},["img",{src:L.Img,className:"TeaserImage"},null,"span",{className:"TeaserBody"},["h2",{},L.Heading,"span",{className:"TeaserText"},L.Body]]);$("#ctl00_cphMain_BoxTrigger").fadeIn("slow")}else{$("#ctl00_cphMain_BoxTrigger").hide()}}function f(N){var M=[];for(var L=0;L<N.length;L++){M.push({data:N[L],value:N[L].Name,result:N[L].Name})}window.AutoComplete=N.length>0;return M}function b(L){return L.Name}function u(O,N,M,L){if(N){$(z.Get("Query").Element).val("");a.Search({Name:M,Property:"Areas",Value:N.Id,Compare:"in"})}}function A(){if(!j.IsLoaded()){setTimeout(A,1000)}j.Markers.Clear();for(var L=0;L<q.length;L++){if(q[L].Latitude!=null&&q[L].Longitude!=null){j.Markers.Add(j.LatLng(q[L].Latitude,q[L].Longitude),q[L].Id,{IsBusiness:true,Category:s(q[L].Categories)},false,{title:q[L].Heading})}}if(j.Markers.All().length>0){l=false;j.CenterOnMarkers()}}function v(N){if(!N.IsClustered){var L=q.FindObj("Id",N.Marker.id);if(L>-1){var M=q[L];window.location=window.Settings.ProductPageUrl+"/"+M.Id+"/"+M.FriendlyUrl+"/"}}}function s(N){var M=1000;for(var L=0;L<N.length;L++){if(N[L]<M){M=N[L]}}return M}}function ExpandFilter(b,e){var d=$(b).parent().parent().parent().next("ul");if(d.length==0){d=$(b).parent().parent().parent().find("ul:first")}var c=d.toggleClass("Hidden").hasClass("Hidden");if(c){$(b).find("img").attr("src","/images/gui/search_filter_item_switch.png")}else{$(b).find("img").attr("src","/images/gui/search_filter_item_switch_on.png")}}function Window_Scroll(b){var a=0;if($(document).scrollTop()>_ScrollContentTop){a=$(document).scrollTop()-_ScrollContentTop}if($.browser.msie&&$.browser.version<=6){$("#ScrollContent").css("top",a)}else{$("#ScrollContent").animate({top:a},{duration:500,queue:false})}};